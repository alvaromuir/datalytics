// Generated by CoffeeScript 1.7.1
(function() {
  var db_init, _;

  _ = require('lodash');

  db_init = require('./db');

  module.exports = function(server, db_host, db_name) {
    var db;
    db = db_init(db_host, db_name);
    server.get('/hello/:name', function(req, res, next) {
      res.send({
        hello: req.params.name,
        date: new Date
      });
      return next();
    });
    server.get('/api/placements', function(req, res, next) {
      return db.Placements.find(function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          placements: rslts
        });
      });
    });
    server.get('/api/placements/:id', function(req, res, next) {
      return db.Placements.findById(req.params.id, function(err, doc) {
        if (err) {
          return err;
        }
        return res.send(doc);
      });
    });
    server.get('/api/placements/:placement', function(req, res, next) {
      return db.Placements.find({
        'Placement': req.params.placement
      }, function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          placements: rslts
        });
      });
    });
    server.get('/api/campaigns', function(req, res, next) {
      return db.Placements.distinct('Campaign', function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          campaigns: rslts
        });
      });
    });
    server.get('/api/campaigns/:campaign_id', function(req, res, next) {
      return db.Placements.find({
        Campaign: req.params.campaign_id
      }, function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          placements: rslts
        });
      });
    });
    server.get('/api/sites', function(req, res, next) {
      return db.Placements.distinct('Site (DFA)', function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          sites: rslts
        });
      });
    });
    server.get('/api/sites/:site', function(req, res, next) {
      return db.Placements.find({
        'Site (DFA)': req.params.site
      }, function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          placements: rslts
        });
      });
    });
    server.get('/api/groups', function(req, res, next) {
      return db.Placements.distinct('Placement Group', function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          'placement groups': rslts
        });
      });
    });
    server.get('/api/groups/:group', function(req, res, next) {
      return db.Placements.find({
        'Placement Group': req.params.group
      }, function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          placements: rslts
        });
      });
    });
    server.get('/api/tactics', function(req, res, next) {
      return db.Placements.distinct('Placement Tactic', function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          'placement tactics': rslts
        });
      });
    });
    server.get('/api/tactics/:tactic', function(req, res, next) {
      return db.Placements.find({
        'Placement Tactic': req.params.tactic
      }, function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          placements: rslts
        });
      });
    });
    server.get('/api/segments', function(req, res, next) {
      return db.Placements.distinct('DMP Segment', function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          'dmp segments': rslts
        });
      });
    });
    return server.get('/api/segments/:segment', function(req, res, next) {
      return db.Placements.find({
        'DMP Segment': req.params.segment
      }, function(err, rslts) {
        var count;
        if (err) {
          return err;
        }
        count = rslts.length;
        return res.send({
          total: count,
          placements: rslts
        });
      });
    });
  };

}).call(this);
